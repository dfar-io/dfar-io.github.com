---
title: SSHing into an Azure Kubernetes Service node
author: dfar

date: 2019-03-25T15:09:40+00:00
excerpt: |
  
  <![CDATA[]]>
url: /sshing-into-an-azure-kubernetes-service-node/
categories:
  - Uncategorized

---
 <p>First, a few reasons why you might do this:</p> <ul><li>If you were looking to view and/or retrieve files from the node itself, perhaps generated by a pod.</li><li>If you wanted to get more information on the OS running for the node.</li></ul> <h2>Generate an SSH Key</h2> <p>First, generate an SSH key to connect to the server with, noting where you save:</p> <pre class="wp-block-preformatted">ssh-keygen</pre> <h2>Add Public SSH Key to Node</h2> <p>Next, add your generated public SSH key to the node, alongside a user:</p> <pre class="wp-block-preformatted">az vm user update --resource-group <RESOURCE\_GROUP> --name <NODE\_NAME> --username azureuser --ssh-key-value <PUBLIC\_SSH\_KEY\_LOCATION></pre> <h2>Setting up to SSH</h2> <p>To actually SSH into the node, there are two ways you can do this:</p> <ol><li>Open the node via a public IP address and SSH into it directly from your machine. This is the easiest and my preferred way to do this, but requires the ability to make changes to the network interface of the node.</li><li>Create a pod with OpenSSH installed to ssh into the node while connected.</li></ol> <h3>Method 1: Public IP Address</h3> <p>First, access the network interface of the node you&#8217;re trying to access. Access IP Configurations, and click the &#8216;ipconfig1&#8217; configuration. Add a public IP:</p> <figure class="wp-block-image"><img src="http://40.76.37.251/wp-content/uploads/2019/03/image-13.png" alt="" class="wp-image-326"/></figure> <p>Next, create an NSG rule for the cluster with the following info:</p> <ul><li>Source: your local IP address (<a href="https://canihazip.com/s">https://canihazip.com/s</a>)</li><li>Destination: the private IP address of the node.</li><li>Destination port ranges: 22</li><li>Protocol: TCP</li></ul> <h3>Method 2: Creating OpenSSH Pod</h3> <p>I&#8217;ll fill this out at some point.</p> <h2>SSHing into the Node</h2> <p>After following either of the methods above, the final step is actually SSHing into the node. If you&#8217;ve been using PowerShell here, I&#8217;d switch to WSL:</p> <pre class="wp-block-preformatted">sudo ssh -i <PUBLIC\_SSH\_KEY\_DIR> azureuser@<PUBLIC_IP></pre> <figure class="wp-block-image"><img src="http://40.76.37.251/wp-content/uploads/2019/03/image-14.png" alt="" class="wp-image-327"/></figure> <h2>Clean Up</h2> <p>Once you&#8217;ve finished, I recommend:</p> <ul><li>Removing the SSH access rule from the NSG.</li><li>Removing the public IP address from the AKS node network interface.</li></ul>