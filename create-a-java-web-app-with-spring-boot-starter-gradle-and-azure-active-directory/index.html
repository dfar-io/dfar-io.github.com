<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Software/DevOps Engineer"><link rel="shortcut icon" href=https://dfar.io/favicon.ico><link rel=stylesheet href=/css/style.min.css><title>Create a Java Web App with Spring Boot Starter, Gradle, and Azure Active Directory</title></head><body><header id=banner><h2><a href=https://dfar.io/>Dave Farinelli</a></h2><nav><ul><li><a href=/about/ title=about>about</a></li></ul></nav></header><main id=content><article><header id=post-header><h1>Create a Java Web App with Spring Boot Starter, Gradle, and Azure Active Directory</h1><time>March 13, 2019</time></header><p>Working on a project that would eventually use Azure Active Directory for authentication, I wanted to use <a href="https://docs.microsoft.com/en-us/java/azure/spring-framework/configure-spring-boot-starter-java-app-with-azure-active-directory?view=azure-java-stable">Microsoft’s guide</a> to get started with an app that could authenticate. However, the guide is written using Maven – and in our case, we are using Gradle for builds across the ecosystem.</p><p>I was able to mostly follow the guide provided, but ran into a gotcha – involving having to add a fixed dependency to get the system working. In addition, I added a secondary API endpoint to allow for testing both with and without group authentication.</p><p>To get started, you’ll need the following:</p><ul><li>Azure Subscription</li><li>Java IDE (I use IntelliJ IDEA Community)</li></ul><h2 id=create-an-app-with-spring-initializr>Create an App With Spring Initializr</h2><p>To get started, create an app at <a href=https://start.spring.io/>https://start.spring.io/</a> with the following information:</p><ul><li><strong>Project</strong>: Gradle</li><li><strong>Project Metadata Artifact</strong>: oauth2-demo-gradle</li><li><strong>Dependencies</strong>: Web, Security, Azure Active Directory</li></ul><p></p><p>After clicking ‘Generate Project’, a ZIP file will be created. Extract this file to someone on your local machine, as you’ll be configuring it later.</p><h2 id=set-up-azure-active-directory>Set Up Azure Active Directory</h2><p>After the app is created, the next step is setting up Azure Active Directory for authentication. Follow the Create Azure Active Directory instance section, taking note of the App Registration information provided.</p><p>Once you get to the section involving configuration of the app, come back to this guide – you’ll make specific changes to make the testing experience both compatible with Gradle and a little more user-friendly.</p><h2 id=configure-and-compile-the-app>Configure and Compile the App</h2><p>Once Azure Active Directory is configured, open your Java IDE and import the <strong>build.gradle</strong> file as a project. After that’s done, there are a few files to configure/create.</p><p>Add the following dependencies into the <strong>build.gradle</strong> file <em>(notice the third dependency, if this one is not added, you’ll run into an exception when testing)</em>:</p><p>Edit /src/main/resources/application.properties to look like the following:</p><p>Create a file called <strong>/controller/HelloController.java</strong> and add the following:</p><p>Create another file called security/WebSecurityConfig.java and add the following:</p><h2 id=build-and-verify-app>Build and Verify App</h2><p>Now that the configuration is complete, next step is building and testing. Run the following Gradle commands <em>(easy way to do this is through the IDE)</em>:</p><p>You should end up with a log like the following:</p><p></p><p>Once this is confirmed, access http://localhost:8080/version. You should be able to access <strong>without</strong> logging into Azure.</p><p>Next, check <a href=http://localhost:8080/secure>http://localhost:8080/secure</a>. You should receive a request to log in to Azure services. Log in as the user created in the step above, and you should be able to get a Hello World message.</p><p>Finally, confirm that the /secureByGroup endpoint is also working. This endpoint will verify the logged in user is part of a verified group.</p><p>This code can be found at</p><p>Reference: <a href="https://docs.microsoft.com/en-us/java/azure/spring-framework/configure-spring-boot-starter-java-app-with-azure-active-directory?view=azure-java-stable">https://docs.microsoft.com/en-us/java/azure/spring-framework/configure-spring-boot-starter-java-app-with-azure-active-directory?view=azure-java-stable</a></p><p>]]></p></article></main><footer id=footer></footer></body></html>