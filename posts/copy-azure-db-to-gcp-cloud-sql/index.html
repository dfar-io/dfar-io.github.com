<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Software/DevOps Engineer"><link rel="shortcut icon" href=https://dfar.io/favicon.ico><link rel=stylesheet href=/css/style.min.css><title></title></head><body><header id=banner><h2><a href=https://dfar.io/>Dave Farinelli</a></h2><nav><ul><li><a href=/about/ title=about>about</a></li></ul></nav></header><main id=content><article><header id=post-header><h1></h1></header><h2 id=draft-false>z&mdash;
title: &ldquo;Copy Azure SQL Database to GCP Cloud SQL&rdquo;
date: 2023-10-11T18:43:08Z
draft: false</h2><h2 id=pre-reqs>Pre-reqs</h2><ul><li>Azure Account with both:<ul><li>Azure SQL and Storage Account</li><li>Azure SQL needs to allow Azure to access resource.</li></ul></li><li>GCP Account with:<ul><li>Cloud SQL (needs contained database authentication flag)</li></ul></li><li>SSMS</li><li>SQL Server Developer Edition (match version used in Cloud SQL)<ul><li>Needs <code>sp_configure</code> for contained database authentication.</li></ul></li></ul><h2 id=process>Process</h2><ol><li>(Linux) In Azure, scale up the DB to max DTUs to speed export process.</li><li>Export .bacpac to Azure Storage Account.</li><li>After export completion, scale DB back down to previous DTUs.</li><li>(Windows) Download .bacpac using Azure Storage Explorer.</li><li>Connect to local SQL via SSMS.</li><li>Import Data-tier Application</li><li>Create .bak (Database -> Tasks -> Backup)</li><li>Upload .bak to storage account. (Program Files/Microsoft SQL Server/**)</li><li>Delete .bacpac with Azure Storage Explorer</li><li>(Linux) Create SAS via Portal</li><li>Create and run STS job to copy file.</li><li>Import .bak from GCS bucket to GCP Cloud SQL.</li></ol><h2 id=troubleshooting>Troubleshooting</h2><ul><li>Low Disk Space - use WinDirStat, <a href=https://helpdeskgeek.com/windows-11/what-is-the-winsxs-folder-why-is-it-huge-and-how-to-cleanup/>clear out WInSxS folder</a></li></ul></article></main><footer id=footer></footer></body></html>