<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Software/DevOps Engineer"><link rel="shortcut icon" href=https://dfar.io/favicon.ico><link rel=stylesheet href=/css/style.min.css><title>Getting Started With Playwright</title></head><body><header id=banner><h2><a href=https://dfar.io/>Dave Farinelli</a></h2><nav><ul><li><a href=/about/ title=about>about</a></li></ul></nav></header><main id=content><article><header id=post-header><h1>Getting Started With Playwright</h1><time>May 14, 2022</time></header><ol><li><a href=#setting-up-with-vscode>Setting up with VSCode</a></li><li><a href=#setting-up-video-playback>Setting up video playback</a></li><li><a href=#setting-up-local-environment-variables-with-env>Setting up local environment variables with .env</a></li><li><a href=#setting-up-github-actions>Setting up Github Actions</a></li></ol><h2 id=setting-up-with-vscode>Setting up with VSCode</h2><ol><li>Create a dev container using the Ubuntu image (include Node.js), then rebuild into dev container</li><li>Install Playwright into your project with <code>npm i -D playwright</code></li><li>Add the following <code>postCreateCommand</code> in <code>.devcontainer/devcontainer.json</code></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#e6db74>&#34;postCreateCommand&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;rm -rf node_modules &amp;&amp; npm i&#34;</span><span style=color:#960050;background-color:#1e0010>,</span>
</span></span></code></pre></div><ol><li>Add the following to <code>package.json</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#e6db74>&#34;scripts&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> {
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;postinstall&#34;</span>: <span style=color:#e6db74>&#34;npx playwright install &amp;&amp; npx playwright install-deps&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol><li>Create <a href=https://playwright.dev/docs/library#first-script>the first script</a>, run using <code>node main.ts</code></li></ol><h2 id=setting-up-video-playback>Setting up video playback</h2><p>This allows for video playback to occur of all runs, very useful for debugging issues. An example where video will be played inside the <code>try</code> block and will generate a video regardless of success or failure:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span>(<span style=color:#66d9ef>async</span> () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>browser</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>webkit</span>.<span style=color:#a6e22e>launch</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>context</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>browser</span>.<span style=color:#a6e22e>newContext</span>({
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>recordVideo</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>dir</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;video&#39;</span> }
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>page</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>newPage</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// executing code
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>err</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>close</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#a6e22e>err</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>close</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>browser</span>.<span style=color:#a6e22e>close</span>();
</span></span><span style=display:flex><span>})();
</span></span></code></pre></div><h2 id=setting-up-local-environment-variables-with-env>Setting up local environment variables with .env</h2><p>Playwright&rsquo;s preferred method for handling variables is to use environment variables, so being able to locally define variables in your development container is very helpful.</p><p>Create <code>.devcontainer/.env.example</code> and fill it with desired keys:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>NAME<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>PHONE<span style=color:#f92672>=</span>
</span></span></code></pre></div><p>Copy this file as <code>.devcontainer/.env</code> and fill in the desired values:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>NAME<span style=color:#f92672>=</span>YourName
</span></span><span style=display:flex><span>PHONE<span style=color:#f92672>=</span><span style=color:#ae81ff>1234567890</span>
</span></span></code></pre></div><p>Create methods getEnvVars and verifyEnvVars for convenience in your script:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getEnvVars() {</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>envVars</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>NAME</span>: <span style=color:#66d9ef>process.env.NAME</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>PHONE</span>: <span style=color:#66d9ef>process.env.PHONE</span>,
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>verifyEnvVars</span>(<span style=color:#a6e22e>envVars</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>envVars</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>verifyEnvVars</span>(<span style=color:#a6e22e>env_vars</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>property</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>env_vars</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>env_vars</span>[<span style=color:#a6e22e>property</span>];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>value</span> <span style=color:#f92672>===</span> <span style=color:#66d9ef>undefined</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>value</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;&#39;</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>`Environment variable </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>property</span><span style=color:#e6db74>}</span><span style=color:#e6db74> not defined.`</span>)
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>exit</span>(<span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Add the following line to <code>devcontainer.json</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#75715e>// add environment variables from .env
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#e6db74>&#34;runArgs&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> [<span style=color:#e6db74>&#34;--env-file&#34;</span>, <span style=color:#e6db74>&#34;.devcontainer/.env&#34;</span>]
</span></span></code></pre></div><p>Rebuild and verify usage:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>env</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getEnvVars</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>await</span> <span style=color:#a6e22e>page</span>.<span style=color:#a6e22e>fill</span>(<span style=color:#e6db74>&#39;#txtGuestFirstName&#39;</span>, <span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>FIRST_NAME</span>);
</span></span></code></pre></div><h2 id=setting-up-github-actions>Setting up Github Actions</h2><p>This allows for running Playwright jobs automatically either on demand or on a schedule from anywhere. Example below assumes an application reading an email and password from environment variables.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>Playwright Script</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>schedule</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>cron</span>: <span style=color:#e6db74>&#39;0 20 * * *&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>workflow_dispatch</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>push</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>branches</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>NODE_VERSION</span>: <span style=color:#e6db74>&#39;16.x&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>run</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>EMAIL</span>: <span style=color:#ae81ff>${{ secrets.EMAIL }}</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>PASSWORD</span>: <span style=color:#ae81ff>${{ secrets.PASSWORD }}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#39;Checkout GitHub Action&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v2</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Setup Node ${{ env.NODE_VERSION }} environment</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/setup-node@v1</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>node-version</span>: <span style=color:#ae81ff>${{ env.NODE_VERSION }}</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Install dependencies</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>run</span>: <span style=color:#ae81ff>npm i</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Run Playwright script</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>run</span>: <span style=color:#ae81ff>node main.ts</span>
</span></span></code></pre></div></article></main><footer id=footer></footer></body></html>