<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Software/DevOps Engineer"><link rel="shortcut icon" href=https://dfar.io/favicon.ico><link rel=stylesheet href=/css/style.min.css><title>Scaffolding a Ruby on Rails Api</title></head><body><header id=banner><h2><a href=https://dfar.io/>Dave Farinelli</a></h2><nav><ul><li><a href=/about/ title=about>about</a></li></ul></nav></header><main id=content><article><header id=post-header><h1>Scaffolding a Ruby on Rails Api</h1><time>March 6, 2021</time></header><h2 id=visual-studio-code-setup>Visual Studio Code Setup</h2><p>First, I recommend getting VSCode&rsquo;s Remote Container set up to allow for container-based development and not requiring adding dependencies to your local machine.</p><p>Create a directory that will store your Rails project.</p><p><code>mkdir rails-api</code>
<code>cd rails-api</code></p><p>Then download the Remote Containers VSCode extension, and add a <code>.devcontainer</code> file using the Ruby on Rails community image.</p><h2 id=scaffolding-the-rails-api>Scaffolding the Rails API</h2><p>Inside the container, create the Rails API using <code>rails new . --api</code>.</p><p>You can now push this</p><h2 id=set-up-debugging-for-vscode>Set up Debugging for VSCode</h2><p>To set up debugging inside VSCode, run the following commands:</p><pre><code>bundle add ruby-debug-ide debase
</code></pre><p>Then add the following to <code>.vscode/launch.json</code>:</p><pre><code>{
    // Use IntelliSense to learn about possible attributes.
    // Hover to view descriptions of existing attributes.
    // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387
    &quot;version&quot;: &quot;0.2.0&quot;,
    &quot;configurations&quot;: [{
        &quot;name&quot;: &quot;Rails server&quot;,
        &quot;type&quot;: &quot;Ruby&quot;,
        &quot;request&quot;: &quot;launch&quot;,
        &quot;cwd&quot;: &quot;${workspaceRoot}&quot;,
        &quot;program&quot;: &quot;${workspaceRoot}/bin/rails&quot;,
        &quot;pathToRDebugIDE&quot;: &quot;~/.asdf/shims/rdebug-ide&quot;,
        &quot;showDebuggerOutput&quot;: true,
        &quot;args&quot;: [
          &quot;server&quot;
        ]
    }]
}
</code></pre><p>You&rsquo;ll now be able to run and debug the API locally at port 3000.</p><p>Finally, edit the <code>.devcontainer/devcontainer.json</code> file to have <code>postCreateCommand</code> use <code>bundle install</code> so dependencies for the container will always load on build.</p><h2 id=create-endpoint>Create endpoint</h2><p>To create an endpoint, use the following command:</p><p><code>rails g scaffold &lt;entity> &lt;fields></code></p><p>So as an example:</p><p><code>rails g scaffold person name:string title:string</code></p><p>Start the application and view the endpoint created above, noting that CRUD functionality is built in.</p><h3 id=seeding-data>Seeding Data</h3><p>You may want to seed data - to do so, edit the <code>seeds.rb</code> file to include data for your class. After that, run the <code>rake db:setup</code> command to set up the DB with the migrations and seeded data correctly.</p><p>An easy way to automate this is to add the <code>rake db:reset</code> step to the <code>postCreateCommand</code> script for the Remote Container, running <code>bundle install && rake db:reset</code>. This will clear the DB on rebuild of the container, and run all migrations.</p><h2 id=deploying-to-heroku>Deploying to Heroku</h2><h3 id=setting-up-postgresql>Setting up PostgreSQL</h3><p>To deploy to Heroku, the Rails app needs to use Postgresql instead of sqlite.</p><p>First, set up Postgresql in your development container using <a href=https://dev.to/imiked/starting-a-rails-app-using-vscode-containers-1gj9>this guide</a>.</p><p>Next, set up the appropriate gems:</p><pre><code>bundle add pg
bundle remove sqlite3
</code></pre><p>Finally, edit <code>config/database.yml</code>:</p><pre><code>default: &amp;default
  adapter: postgresql
  encoding: unicode
  host: db
  user: postgres
  password: &lt;%= ENV.fetch(&quot;DB_PASSWORD&quot;) %&gt;
  # For details on connection pooling, see Rails configuration guide
  # https://guides.rubyonrails.org/configuring.html#database-pooling
  pool: &lt;%= ENV.fetch(&quot;RAILS_MAX_THREADS&quot;) { 5 } %&gt;

</code></pre><p>Rebuild the container and run locally to verify everything working.</p><h3 id=deploying>Deploying</h3><p>Once this is done, you can deploy the app to Heroku. You can do this manually
using Heroku CLI, or you can connect the app via GitHub and Heroku to enable
automatic deployments. If you run into issues, you can pull the logs from
Heroku CLI.</p><p>After the app is deployed, you&rsquo;ll need to migrate the DB changes using:</p><p><code>heroku run rake db:migrate</code></p><p>If seed data is desired, you can then run</p><p><code>heroku run rake db:seed</code></p><h2 id=setting-up-cors>Setting up CORS</h2><p>To set up CORS capabilities, check <a href=https://dev.to/phillipug/comment/16l66>this guide</a></p><p>You can then verify with <a href=https://gist.github.com/exAspArk/07bbbafa2a9171b6c260989780cc0955>this command</a></p></article></main><footer id=footer></footer></body></html>