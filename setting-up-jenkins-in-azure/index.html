<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Software/DevOps Engineer"><link rel="shortcut icon" href=https://dfar.io/favicon.ico><link rel=stylesheet href=/css/style.min.css><title>Setting up Jenkins in Azure</title></head><body><header id=banner><h2><a href=https://dfar.io/>Dave Farinelli</a></h2><nav><ul><li><a href=/about/ title=about>about</a></li></ul></nav></header><main id=content><article><header id=post-header><h1>Setting up Jenkins in Azure</h1><time>July 8, 2019</time></header><p>Before getting started, you’ll need to have:</p><ul><li>An Azure tenant and subscription.</li><li>OpenSSH (<a href=https://docs.microsoft.com/en-us/windows-server/administration/openssh/openssh_install_firstuse>installation</a> for Windows 10)</li></ul><h2 id=installing-jenkins-via-azure-marketplace>Installing Jenkins via Azure Marketplace</h2><p>The easiest way to install Jenkins is to use the <a href=https://azuremarketplace.microsoft.com/en-us/marketplace/apps/azure-oss.jenkins>Azure Marketplace</a> link. A couple suggestions when setting up:</p><ul><li>I recommend using an SSH Public Key to sign in. If you haven’t yet, generate one using <code>ssh-keygen</code> and then get it using <code>cat ~.ssh\id_rsa.pub</code></li><li>Set up a domain name label, especially if you aren’t planning to put this behind a different domain.</li><li>Set the VM as B1ms starting off – you can upgrade later as the system is used more.</li></ul><p>After creation, modify the NSG created and use your public IP to secure SSH access (check your public IP).</p><p>Next, SSH into the server using the IP and check to see if you can update the OS (as of this writing, the image ships with Ubuntu 16.04 LTS, and can be upgraded to 18.04 LTS).</p><h2 id=connecting-a-domain>Connecting a Domain</h2><p>If you’re planning to use a different domain to host Jenkins (as opposed to the provided <em>domain-name-label</em>.<em>location</em>.cloudapp.azure.com), set the following DNS record:</p><ul><li>CNAME</li><li>Host: desired subdomain (ex. jenkins -> jenkins.dfar.io)</li><li>Value: DNS record from Azure.</li></ul><p>Since DNS will take a second, check to verify you can access the new server.</p><h2 id=setting-up-ssl-using-let8217s-encrypt>Setting up SSL using Let’s Encrypt</h2><p>The next step is setting up SSL using Let’s Encrypt to allow for an HTTPS connection. First, open the 443 port on the VM:</p><p>Now SSH into the server and modify SSL Offloading:</p><p>Use the following configuration:</p><p>Then run the following commands:</p><h2 id=accessing-and-logging-into-jenkins>Accessing and Logging Into Jenkins</h2><p>After completed, access the Jenkins instance at your domain. Verify that both the SSL connection is valid and that you are on the ‘Unlock Jenkins’ page:</p><p></p><p>Run the following command in the SSHed server to get a code for the screen:</p><p>Next, you’ll get a request to either install suggested plugins or select plugins as desired. <strong>I recommend going through and selecting the plugins desired to keep the installation minimal</strong>. Remove anything from the list that you may not need (such as Subversion). You can always add plugins later if you find you need.</p><p>After that, create an admin user for yourself, and you’ll be ready to get started!</p><h2 id=next-steps>Next Steps</h2><p>After you’ve finished setting up Jenkins, a few next steps would be:</p><ul><li>Setting up a CI/CD job</li><li><a href=https://dfar.io/setting-up-jenkins-with-azure-ad-authentication/>Setting up Azure AD Authentication</a></li></ul><h2 id=reference>Reference</h2></article></main><footer id=footer></footer></body></html>