<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Software/DevOps Engineer"><link rel="shortcut icon" href=https://dfar.io/favicon.ico><link rel=stylesheet href=/css/style.min.css><title>Setting up Jenkins with Azure AD Authentication</title></head><body><header id=banner><h2><a href=https://dfar.io/>Dave Farinelli</a></h2><nav><ul><li><a href=/about/ title=about>about</a></li></ul></nav></header><main id=content><article><header id=post-header><h1>Setting up Jenkins with Azure AD Authentication</h1><time>July 8, 2019</time></header><h3 id=CreatingaJenkinsserverthroughAzure-ConfiguringAzureAD>Configuring Azure AD</h3><p>Run the following command in CLI to generate a service principal:</p><p>Save the output generated, as you’ll use it for configuration in Jenkins.</p><p>Create a Redirect URL to <a href=http://bams-jenkins.eastus.cloudapp.azure.com/securityRealm/finishLogin>https://YOURHOST/securityRealm/finishLogin</a></p><p></p><p>Set Required Permissions in Azure Active Directory to:</p><ul><li>Application Permissions (Read Directory Data)</li><li>Delegated Permissions (Read Directory Data)</li></ul><p>Click on ‘Grant permissions’.</p><p></p><p>If planning to use an Azure AD group for authorization, create one now.</p><h3 id=CreatingaJenkinsserverthroughAzure-ConfiguringJenkins>Configuring Jenkins</h3><p>Download the ‘Azure AD’ plugin, and restart after installation.</p><p>Go to Manage Jenkins → Configure Global Security.</p><p>Select ‘Enable Security’ if it isn’t already selected.</p><p>Under ‘Security Realm’, select ‘Azure Active Directory’, and fill the information:</p><ul><li>Client ID – ‘appId’</li><li>Client Secret – ‘password’</li><li>Tenant – ‘tenant’</li></ul><p>Use the button to verify the application.</p><p>Set Authorization to ‘Azure Active Directory Matrix-based security’.</p><p>Set the Group to be the newly created, and assign the appropriate permissions.</p><p>Verify by logging out and logging back in as Azure AD user.</p><h2 id=CreatingaJenkinsserverthroughAzure-Troubleshooting>Troubleshooting</h2><p>If you accidentally lock yourself out after enabling Azure AD, do the following:</p><p>SSH into the server.</p><p>modify the config.xml file</p><ul><li>For the useSecurity item, change to ‘false’</li><li>Remove authorizationStrategy and securityRealm sections.</li></ul><p>Restart Jenkins:</p><p>Jenkins is now completely unprotected – so continue working on whatever security strategy you were working on.</p></article></main><footer id=footer></footer></body></html>