<!doctype html><html><head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Software/DevOps Engineer">
<link rel="shortcut icon" href=https://dfar.io/favicon.ico>
<link rel=stylesheet href=/css/style.min.css>
<title>Setting up SFTP File Migration to Azure Storage Account</title>
</head>
<body><header id=banner>
<h2><a href=https://dfar.io/>Dave Farinelli</a></h2>
<nav>
<ul>
<li>
<a href=/about/ title=about>about</a>
</li>
</ul>
</nav>
</header>
<main id=content>
<article>
<header id=post-header>
<h1>Setting up SFTP File Migration to Azure Storage Account</h1><time>September 24, 2019</time></header><p>This guide assumes you are using a Linux SFTP server for receiving files, and then uploading those files into an Azure storage account.</p>
<h2 id=initial-setup>Initial Setup</h2>
<p>Install Azure CLI on the SFTP server with the following command:</p>
<p><code>curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash</code></p>
<p>Then login using an account with access to the storage account:</p>
<p><code>az login</code></p>
<h2 id=perform-file-migration>Perform File Migration</h2>
<p>The next step is actually sending the files over to a storage account. For this example, weâ€™ll send all of the files in a particular folder to the storage account.</p>
<p><code>az storage blob upload-batch -d YOUR_CONTAINER --account-name STORAGE_ACCOUNT_NAME -s DIRECTORY</code></p>
<p>Once those files are moved over, move them into a <code>processed/</code> directory:</p>
<p><code>mkdir /data/ftpuser/upload/processed</code></p>
<p><code>sudo mv * /processed/</code></p>
<h2 id=automate-migration-process>Automate Migration Process</h2>
<p>The final step is making sure to automate the process to allow for migrating files on a regular interval.</p>
<p>First, create a file named <code>/bin/migrate.sh</code>:</p>
<p>Allow the script to be executable:</p>
<p><code>chmod u+x /bin/migrate.sh</code></p>
<p>Then edit cronjobs to run every 15 minutes:</p>
<p><code>sudo crontab -e</code></p>
<p>You can check the logs of the process here:</p>
<p><code>/var/log/migrate_output.log</code></p>
<h2 id=reference>Reference</h2>
<p><a href=https://kvz.io/schedule-tasks-on-linux-using-crontab.html>https://kvz.io/schedule-tasks-on-linux-using-crontab.html</a></p>
</article>
</main><footer id=footer>
</footer>
</body>
</html>