<!doctype html><html><head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Software/DevOps Engineer">
<link rel="shortcut icon" href=https://dfar.io/favicon.ico>
<link rel=stylesheet href=/css/style.min.css>
<title>Setting Up SonarQube in Azure with Azure AD Integration</title>
</head>
<body><header id=banner>
<h2><a href=https://dfar.io/>Dave Farinelli</a></h2>
<nav>
<ul>
<li>
<a href=/about/ title=about>about</a>
</li>
</ul>
</nav>
</header>
<main id=content>
<article>
<header id=post-header>
<h1>Setting Up SonarQube in Azure with Azure AD Integration</h1><time>June 9, 2019</time></header><h2 id=SettingUpSonarQubeinAzurewithAzureADIntegration-InstallingSonarQube>Installing SonarQube</h2>
<p>Go to the marketplace and install SonarQube from Bitnami – <a href=https://bitnami.com/stack/sonarqube/cloud/azure>https://bitnami.com/stack/sonarqube/cloud/azure</a> with the following:</p>
<ul>
<li>resize to D1_v2</li>
<li>if desired, configure any NSG restrictions</li>
</ul>
<p>After creation, set a DNS name label for the IP address.</p>
<p>Access using the domain name, and follow the directions in the link above to log in.</p>
<h2 id=SettingUpSonarQubeinAzurewithAzureADIntegration-SettingupAzureADIntegration>Setting up Azure AD Integration</h2>
<h3 id=SettingUpSonarQubeinAzurewithAzureADIntegration-SettingupHTTPS>Setting up HTTPS</h3>
<p>To be able to use Azure AD, you have to use HTTPS.</p>
<p>Set up the Server base URL to be the configured HTTPS address in Administration → Configuration → General → Server base URL:</p>
<p> </p>
<p>SSH into the server and set up a Let’s Encrypt script and enforce redirection to HTTPS here (make sure you aren’t behind a firewall to allow for Let’s Encrypt).</p>
<ul>
<li><a href=https://docs.bitnami.com/aws/how-to/generate-install-lets-encrypt-ssl/>https://docs.bitnami.com/aws/how-to/generate-install-lets-encrypt-ssl/</a></li>
<li><a href=https://docs.bitnami.com/bch/apps/wordpress/administration/force-https-apache/>https://docs.bitnami.com/bch/apps/wordpress/administration/force-https-apache/</a></li>
</ul>
<p>Restart Apache:</p>
<p>Verify that trying to access the HTTP version of SonarQube automatically redirects you to the HTTPS version.</p>
<h3 id=SettingUpSonarQubeinAzurewithAzureADIntegration-CreatingAppRegistrationinAzure>Creating App Registration in Azure</h3>
<p>Run the following command in CLI to generate a service principal:</p>
<p>You should receive some output data, which you will use when filling out info in SonarQube:</p>
<p> </p>
<p>Set the Reply URL of the application to https:///oauth2/callback/aad: </p>
<p> </p>
<p>Set the required permissions:</p>
<ul>
<li>Sign in and read user profile</li>
<li>Read all users’ basic profiles</li>
</ul>
<p> </p>
<h3 id=SettingUpSonarQubeinAzurewithAzureADIntegration-InstallingPlug-in>Installing Plug-in</h3>
<p>Install the Azure Active Directory (AAD) Authentication Plug-in for SonarQube (restarting when requested):</p>
<p><img src="https://bamsmcg.atlassian.net/wiki/download/thumbnails/577962004/image2019-4-8_12-21-4.png?version=1&modificationDate=1554740466177&cacheVersion=1&api=v2&width=1213&height=250" alt> </p>
<p>Configure in Administration → General Settings → Azure Active Directory:</p>
<ol>
<li>Activate Azure AD</li>
<li>Use the value in “appId”</li>
<li>Use the value in “password”</li>
<li>Use the value in “tenant”</li>
<li>Allow users to sign-up.</li>
</ol>
<p>Log out as admin, and verify the ability to log in as an Azure AD user.</p>
</article>
</main><footer id=footer>
</footer>
</body>
</html>